# 正则表达式

>推荐书籍：`python`语言使用正则表达式

---

## 什么是正则表达式

是一种独立的规则，独立的语言；从大段文字中找到符合规则的内容；正则表达式之和字符串打交道。正则表达式是对字符串操作的一种逻辑公式，就是用事先定义好的一些特定字符、及这些特定字符的组合，组成一个“规则字符串”，这个“规则字符串”用来表达对字符串的一种过滤逻辑。

## 能用来做什么

**爬虫**：从网页的字符串中获取你想要的数据

**日志分析**：提取各种行为数据进行分析

1. 什么是日志：记录具体的行为，包括时间，行为，消费情况等

**表单验证**：验证手机号，身份证号等是否书写正确

## 正则表达式的规则

1. 字符组：`[]`写在中括号中的内容都出现在下面的某一个字符的位置上，都是符合规则的

     要根据`ascii`码大小顺平，从小往大

   1. `[0-9]`匹配数字
   2. `[a-z]`匹配小写字母
   3. `[A-Z]`匹配大写字母
   4. `[a-zA-Z]`匹配大小写字母
   5. `[0-9a-zA-Z_]`数字字母下划线

2. 转义符`\`

   1. 单个`\`用来转义
   2. 要匹配没有转义的`\`需要有偶数`\`

3. 元字符`(15个)` `\w \d \s \n \t \b \W \D \S`

   1. 和转义相关
      1. `\w`匹配数字，字母和下划线
      2. `\d`匹配数字
      3. `\s`匹配所欲的空白符：空格，换行符`\n`，制表符`\t`
      4. `\W,\D,\S`匹配与小写功能相反
      5. `[\s\S] [\w\W] [\d\D]`匹配所有内容
      6. `\b`表示单词的边界

   2. 和转义无关

      1. `^`表示匹配一个字符串的开始
      2. `$`表示匹配一个字符串的结尾

   3. 其他

      1. `.`匹配除换行符之外的所欲字符

      2. `[^ ]`只要不出现中括号中的内容就能被匹配，`^`必须卸载最前面

         1. 有一些特殊意义的元字符进入字符组中会恢复他本来的意义

            `. | [不能成对出现] ( )  量词`取消了特殊意义
      
            `-`在中括号中有特殊意义，用作减号需要转义

      3. `a|b`或 
      
         1. 符合a规则的或者b规则的都可以被匹配
   2. 如果a规则是b规则的一部分，且a规则比b规则要苛刻，就把a规则写在前面
         3. 将更复杂的规则写在前面

      4. `()`分组

         1. 表示给几个字符加上量词约束的需求时，就给这些量词分在一组
      
         ```python
         # 匹配手机号
         1[3-9]\d{9}
         ```
   
4. 量词

   1. `{n}`表示这个量词之前的字符出现n次
   2. `{n,}`表示这个量词之前的字符至少出现n次
   3. `{n,m}`表示这个量词出现`n-m`次
   4. `?`匹配出现0次或1次，表示可有可无
   5. `+`匹配出现1次或多次
   6. `*`匹配0次到多次

   ```python
   # 匹配小数或者整数
   \d+\.\d+|\d+
   \d+(\.\d+)?
   ```

5. 贪婪匹配/懒惰匹配

   1. 贪婪匹配
      1. 在允许的范围内取最长的内容

      2. 默认贪婪匹配

         ![贪婪模式](D:\repository\PythonNotes\notes\第3章 Python语法\images\贪婪模式.png)

   2. 懒惰模式

      1. 在**量词**的后面加上一个`?`

      2. 在范围内尽量少的匹配

      3. `.*?x`匹配任意非换行符字符，任意长度，直到遇到x就停止
      
      4. `李.??和`
      
         1. `.`是元字符，匹配任意非换行字符
         2. 第一个`?`是量词，表示匹配`0-1`次
         3. 第二个`?`是约束惰性匹配的标志，报送`.`的匹配应该尽可能少匹配
         4. 后面的`和`约束力`.`的匹配必须多匹配一个`杰`，否则就没有匹配结果了
         5. 两个问号表示在可能匹配的基础上尽可能少匹配
      
         ![懒惰模式](D:\repository\PythonNotes\notes\第3章 Python语法\images\懒惰模式.png)


## 练习

```python
# 匹配15位或18位身份证号码
[1-9]\d{16}[\dX]|[1-9]\d{14}  # 只能匹配一行里的内容
[1-9]\d{14}(\d{2}[\dX])?
```

## 作业

1. 匹配整数或者小数（包括整数和负数）

```python
-?\d+(\.\d+)?
```

2. 匹配年月日日期，格式`2018-12-6`

```python
[1-9]\d{3}-([1][0-2]|0?[1-9])-(3[01]|[12]\d|0?[1-9])
```

3. 匹配`qq`号

```python
[1-9]\d{4, 11}
```

4. 11位电话号码

```python
1[3-9]\d{9}
```

5. 匹配`8-10`位用户密码，包含数字字母下划线

```python
\w{8, 10}
```

6. 匹配验证码：4位数字字母组成

```python
[\da-zA-Z]{4}
```

7. 匹配邮箱地址

```python
[0-9a-zA-Z][\w\-.]+@[a-zA-Z0-9\-]+(\.[a-zA-Z0-9\-]+)*\.[A-Za-z0-9]{2,6}
```

8. `<a>wahaha</a>`

```python
>\w+<
\w{6}
# 先匹配，再用python修改
```

9. `1-2*((60-30+(-40/5)*(9-2*5/3+7/3*99/4*2998+10*568/14))-(-4*3)/(16-3*2))`从上式中匹配内层无小括号这层的内容加括号

```python
\([^()]+\)
```

10. 从类似`9-2*5/3+7/3*99/4*2998+10*568/14`的表达式中匹配除从左到右第一个乘法或除法

```python
# 匹配的有问题
\d+[*/]\d+
```









